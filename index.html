<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¦å²¡ 2026 | Kuromi å®¶æ—å¤§å†’éšª</title>

    <!-- æ ¸å¿ƒåº«å¼•å…¥ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK (ç›¸å®¹ç‰ˆ) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');
        
        :root {
            --kuromi-purple: #9D76C1;
            --kuromi-dark: #2D2727;
            --kuromi-pink: #FF91C1;
            --kuromi-bg: #F9F7FC;
        }

        body { 
            font-family: 'ZCOOL KuaiLe', cursive; 
            background-color: var(--kuromi-bg); 
            color: var(--kuromi-dark);
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        .kuromi-gradient { background: linear-gradient(135deg, #9D76C1 0%, #765898 100%); }
        .bg-pattern { 
            background-image: radial-gradient(var(--kuromi-purple) 0.5px, transparent 0.5px); 
            background-size: 20px 20px; 
        }

        .kuromi-card { 
            background: white; 
            border-radius: 40px; 
            border: 4px solid #E2D9F3; 
            box-shadow: 0 10px 25px rgba(157, 118, 193, 0.1);
        }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-custom { animation: spin-slow 1s linear infinite; }
        
        /* é¿å…æŒ‰éˆ•æ–‡å­—è¢«é¸å– */
        button { user-select: none; }

        .packing-item-done { opacity: 0.5; background-color: #F3F0F8; border-color: transparent !important; }
        .packing-text-done { text-decoration: line-through; color: #9D76C1; }
    </style>
</head>
<body class="bg-pattern">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ==========================================================
        // ğŸ› ï¸ Firebase é…ç½®
        // ==========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCAb0qAoOh0A88-wuRz-Gk_cU5f2vIOd3c",
            authDomain: "fukuoka-2026.firebaseapp.com",
            projectId: "fukuoka-2026",
            storageBucket: "fukuoka-2026.firebasestorage.app",
            messagingSenderId: "545717934606",
            appId: "1:545717934606:web:0d6ba3dd86addc76a77a5f"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "fukuoka-2026";

        // ğŸ›¡ï¸ æ ¸å¿ƒä¿®å¾©ï¼šä½¿ç”¨å®Œå…¨ç¨ç«‹çš„ SVG æ¸²æŸ“
        const Icon = ({ name, className = "", size = 24 }) => {
            const icons = {
                'heart': "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.505 4.04 3 5.5L12 21l7-7Z",
                'coins': "M11 15h2M12 12V3c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v1h1a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h1V3c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v9Z",
                'check-circle': "M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4L12 14.01l-3-3",
                'trash': "M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",
                'refresh': "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8 M21 3v5h-5 M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16 M3 21v-5h5",
                'hotel': "M3 21V9a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12M7 11h2M7 15h2M15 11h2M15 15h2M11 21v-4a1 1 0 0 1 1-1h0a1 1 0 0 1 1 1v4",
                'alert': "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01",
                'luggage': "M3 14h18M7 21h10M3 7h18a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2zM7 7V4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v3",
                'check': "M20 6L9 17l-5-5",
                'activity': "M22 12h-4l-3 9L9 3l-3 9H2"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={icons[name] || ""} />
                </svg>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [expenses, setExpenses] = useState([]);
            // è¡Œææ¸…å–®æ”¹ç‚ºç´”å–®æ©Ÿç‹€æ…‹ (ä¸é€£çµ Firebase)
            const [packingItems, setPackingItems] = useState({});
            const [activeTab, setActiveTab] = useState('expense');
            const [fxInput, setFxInput] = useState('');
            const exchangeRate = 0.211;
            const [newExpense, setNewExpense] = useState({ 
                date: new Date().toISOString().split('T')[0], 
                payer: 'KCY', item: '', amount: '' 
            });
            const [isSaving, setIsSaving] = useState(false);
            const [toast, setToast] = useState({ show: false, msg: '' });

            const members = ['KCY', 'Ruby', 'YSL', 'Tsai'];
            
            const packingListTemplate = [
                { category: 'ä¸€ã€å¿…å‚™è­‰ä»¶èˆ‡è²¡å‹™', items: ['è­·ç…§ (6å€‹æœˆæ•ˆæœŸ)', 'æ©Ÿç¥¨/è¨‚ä½ç´€éŒ„', 'ä¿¡ç”¨å¡/æ—¥å¹£ç¾é‡‘', 'æ—…éŠä¿éšªæ–‡ä»¶'] },
                { category: 'äºŒã€è¡£ç‰©é…ä»¶', items: ['æ—¥å¸¸è¡£ç‰©/å…§è¡£è¤²/ç¡è¡£/è¥ªå­', 'èˆ’é©å¥½èµ°çš„é‹/æ‹–é‹', 'å¤ªé™½çœ¼é¡/å¸½å­/åœå·¾'] },
                { category: 'ä¸‰ã€ç›¥æ´—èˆ‡ä¿é¤Šå“', items: ['ç‰™åˆ·ç‰™è†/æ¢³å­/æ´—é¢ä¹³', 'åˆ†è£ä¿é¤Šå“/é˜²æ›¬ä¹³', 'è¡›ç”Ÿç´™/ç”Ÿç†ç”¨å“'] },
                { category: 'å››ã€3Cç”¢å“', items: ['æ‰‹æ©Ÿ/å……é›»ç·š/å……é›»å™¨', 'è¡Œå‹•é›»æº (å¿…æ‰‹æ)', 'WiFiæ©Ÿ/ç¶²å¡/è½‰æ¥é ­'] },
                { category: 'äº”ã€è—¥å“ä¿å¥', items: ['æ„Ÿå†’/æ­¢ç—›/è…¸èƒƒ/éæ•è—¥', 'å€‹äººè™•æ–¹è—¥/é˜²èšŠæ¶²', 'Ruby å¸¸å‚™è—¥/OKç¹ƒ'] },
                { category: 'å…­ã€é›œç‰©èˆ‡ Ruby å°ˆå€', items: ['å¥¶ç²‰/å‰¯é£Ÿå“/é¤å…·', 'è¶³é‡å°¿å¸ƒ/æ¿•ç´™å·¾', 'æ°´ç“¶/é›¨å‚˜/é ¸æ•'] }
            ];

            // 1. åˆå§‹åŒ–ç™»å…¥ (åƒ…é‡å°è¨˜å¸³åŠŸèƒ½)
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(u => {
                    if (u) setUser(u);
                    else auth.signInAnonymously().catch(e => console.error("Auth Fail", e));
                });
                return () => unsubscribe();
            }, []);

            // 2. ç›£è½æ”¯å‡ºè³‡æ–™ (ç¶­æŒé›²ç«¯)
            useEffect(() => {
                if (!user) return;
                const unsubExp = db.collection(`artifacts/${appId}/public/data/expenses`).onSnapshot(snap => {
                    const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    setExpenses(docs.sort((a, b) => (b.date || "").localeCompare(a.date || "")));
                });
                return () => unsubExp();
            }, [user]);

            const showToast = (msg) => {
                setToast({ show: true, msg });
                setTimeout(() => setToast({ show: false, msg: '' }), 3000);
            };

            const addExpense = async () => {
                if (!newExpense.item.trim()) { alert("è«‹å¡«å¯«å“é …åç¨±å”·ï¼ğŸ’œ"); return; }
                const amountNum = parseFloat(newExpense.amount);
                if (isNaN(amountNum)) { alert("é‡‘é¡è«‹è¼¸å…¥æ­£ç¢ºæ•¸å­—å”·ï¼ğŸ’œ"); return; }
                if (!user) { alert("é€£ç·šä¸­ï¼Œè«‹ç¨å€™å†è©¦ä¸€æ¬¡ ğŸ’œ"); return; }

                setIsSaving(true);
                try {
                    const id = `exp-${Date.now()}`;
                    await db.collection(`artifacts/${appId}/public/data/expenses`).doc(id).set({
                        ...newExpense,
                        amount: amountNum,
                        amountTwd: Math.round(amountNum * exchangeRate),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setNewExpense(prev => ({ ...prev, item: '', amount: '' }));
                    showToast("å·²å­˜å…¥é›²ç«¯ ğŸ’œ");
                } catch (e) {
                    alert("å„²å­˜å¤±æ•—");
                } finally { setIsSaving(false); }
            };

            // è¡Œææ¸…å–®åˆ‡æ›ï¼šæ”¹ç‚ºç´”æœ¬åœ°æ“ä½œ
            const togglePacking = (item) => {
                setPackingItems(prev => ({
                    ...prev,
                    [item]: !prev[item]
                }));
            };

            const deleteItem = async (id) => {
                if (!window.confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ")) return;
                try {
                    await db.collection(`artifacts/${appId}/public/data/expenses`).doc(id).delete();
                    showToast("å·²å¾é›²ç«¯ç§»é™¤");
                } catch (e) { console.error(e); }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen relative pb-32">
                    {/* Toast æˆåŠŸæç¤º */}
                    <div className={`fixed top-10 left-1/2 -translate-x-1/2 z-[200] transition-all duration-500 ${toast.show ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-10 pointer-events-none'}`}>
                        <div className="bg-black/90 text-white px-8 py-4 rounded-full flex items-center gap-3 shadow-2xl border border-purple-400 backdrop-blur-md">
                            <Icon name="check-circle" className="text-pink-400" />
                            <span className="font-bold tracking-widest">{toast.msg}</span>
                        </div>
                    </div>

                    <header className="kuromi-gradient text-white p-10 pt-16 rounded-b-[80px] shadow-2xl text-center relative overflow-hidden">
                        <h1 className="text-6xl font-bold tracking-tighter" style={{ textShadow: '4px 4px 0px rgba(0,0,0,0.2)' }}>ç¦å²¡ 2026</h1>
                        <div className="flex items-center justify-center gap-3 mt-4">
                            <span className="bg-black/30 px-5 py-2 rounded-full text-xs font-bold uppercase tracking-[0.3em]">KCY FAMILY</span>
                            <Icon name="heart" className="fill-pink-400 text-pink-400 animate-pulse" />
                        </div>
                    </header>

                    <nav className="flex bg-white/95 backdrop-blur-lg sticky top-0 z-50 px-8 mt-4 border-b-8 border-purple-100 shadow-lg">
                        <button onClick={() => setActiveTab('expense')} className={`flex-1 py-7 font-black text-xl transition-all ${activeTab === 'expense' ? 'text-[#9D76C1] border-b-8 border-[#9D76C1]' : 'text-slate-400'}`}>è¨˜å¸³</button>
                        <button onClick={() => setActiveTab('tools')} className={`flex-1 py-7 font-black text-xl transition-all ${activeTab === 'tools' ? 'text-[#9D76C1] border-b-8 border-[#9D76C1]' : 'text-slate-400'}`}>å·¥å…·</button>
                    </nav>

                    <div className="px-8 py-10">
                        {activeTab === 'expense' && (
                            <div className="space-y-12 animate-in fade-in duration-500">
                                {/* åŒ¯ç‡æ›ç®— */}
                                <div className="bg-[#2D2727] text-white p-12 rounded-[60px] shadow-2xl relative overflow-hidden">
                                    <p className="text-md text-[#FF91C1] font-black uppercase tracking-[0.3em] mb-8">JPY â®• TWD å³æ™‚æ›ç®—</p>
                                    <div className="flex items-center justify-between">
                                        <input type="number" value={fxInput} onChange={(e) => setFxInput(e.target.value)} placeholder="0" className="flex-1 bg-transparent text-7xl font-black focus:outline-none placeholder:text-white/10 tracking-tighter w-full" />
                                        <div className="text-right flex-shrink-0">
                                            <p className="text-xs opacity-40 font-black mb-1">NT$</p>
                                            <p className="text-6xl font-black text-[#FF91C1] tracking-tighter">
                                                {Math.round((parseFloat(fxInput) || 0) * exchangeRate).toLocaleString()}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* æ–°å¢è¡¨å–® */}
                                <div className="bg-white rounded-[60px] p-12 space-y-10 shadow-2xl border-[8px] border-purple-100">
                                    <div className="flex justify-between items-center text-slate-800">
                                        <h3 className="text-3xl font-black italic underline decoration-pink-300 decoration-[6px] underline-offset-4">æ–°å¢èŠ±è²» ğŸ’œ</h3>
                                        <select value={newExpense.payer} onChange={(e) => setNewExpense({...newExpense, payer: e.target.value})} className="bg-purple-100 rounded-[30px] px-6 py-4 font-black text-lg text-[#9D76C1] outline-none border-none">
                                            {members.map(m => <option key={m} value={m}>{m}</option>)}
                                        </select>
                                    </div>
                                    <div className="space-y-8">
                                        <input type="date" value={newExpense.date} onChange={(e) => setNewExpense({...newExpense, date: e.target.value})} className="w-full border-b-6 border-purple-50 pb-6 text-2xl font-black focus:border-purple-400 outline-none bg-transparent" />
                                        <input placeholder="è²·äº†ä»€éº¼å¥½æ±è¥¿ï¼Ÿ" value={newExpense.item} onChange={(e) => setNewExpense({...newExpense, item: e.target.value})} className="w-full border-b-6 border-purple-50 pb-6 text-2xl font-black focus:border-purple-400 outline-none" />
                                        <input type="number" placeholder="æ—¥å¹£é‡‘é¡ Â¥" value={newExpense.amount} onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})} className="w-full border-4 border-purple-50 p-7 text-3xl font-black focus:border-purple-400 outline-none bg-slate-50 rounded-[40px]" />
                                    </div>
                                    <button onClick={addExpense} disabled={isSaving} className="w-full kuromi-gradient text-white py-10 rounded-[50px] font-black text-3xl shadow-xl active:scale-95 flex items-center justify-center gap-4 disabled:opacity-70">
                                        {isSaving ? <Icon name="refresh" className="animate-spin-custom" /> : "ç´€éŒ„åˆ°é›²ç«¯ ğŸ’œ"}
                                    </button>
                                </div>

                                {/* åˆ—è¡¨ */}
                                {expenses.map((ex, idx) => (
                                    <div key={ex.id || idx} className="kuromi-card p-10 flex justify-between items-center border-l-[25px] border-l-[#9D76C1] shadow-xl">
                                        <div className="flex-1 mr-2">
                                            <div className="flex items-center gap-4 mb-3">
                                                <span className="text-sm font-black text-white bg-slate-800 px-4 py-1.5 rounded-xl">{ex.date}</span>
                                                <span className="text-md text-slate-400 font-black uppercase tracking-widest">{ex.payer}</span>
                                            </div>
                                            <p className="text-4xl font-black text-slate-700 break-words">{ex.item}</p>
                                        </div>
                                        <div className="text-right flex items-center gap-6">
                                            <div>
                                                <p className="text-5xl font-black text-slate-800 tracking-tighter">Â¥{ex.amount?.toLocaleString()}</p>
                                                <p className="text-md font-black text-pink-400">NT${ex.amountTwd?.toLocaleString()}</p>
                                            </div>
                                            <button onClick={() => deleteItem(ex.id)} className="p-5 bg-red-50 text-red-400 rounded-full active:scale-90"><Icon name="trash" size={32}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'tools' && (
                            <div className="space-y-16 animate-in fade-in duration-500">
                                {/* é£¯åº—è³‡è¨Š */}
                                <section className="text-center">
                                    <div className="bg-white rounded-[60px] border-[10px] border-[#9D76C1] p-12 shadow-2xl relative">
                                        <Icon name="hotel" className="text-purple-200 mx-auto mb-4" size={100} />
                                        <h3 className="text-5xl font-black mb-4 text-[#2D2727]">åšå¤šè¥¿éµ CROOM</h3>
                                        <p className="text-md text-slate-400 mb-12 font-black uppercase tracking-[0.2em]">æ«›ç”°ç¥ç¤¾å‰ç«™ 4 è™Ÿå‡ºå£å°é¢</p>
                                        <div className="flex gap-8">
                                            <button onClick={() => window.open('https://www.google.com/maps/search/?api=1&query=åšå¤šç¥‡åœ’æ«›ç”°ç¥ç¤¾å‰è¥¿éµå…‹é­¯å§†é…’åº—','_blank')} className="flex-1 kuromi-gradient text-white py-9 rounded-[45px] font-black text-2xl shadow-2xl active:scale-95 transition-all">åœ°åœ– ğŸ“</button>
                                            <a href="tel:092-235-0311" className="flex-1 border-6 border-[#2D2727] text-center py-9 rounded-[45px] font-black text-2xl active:scale-95 transition-all">æ’¥æ‰“ ğŸ“</a>
                                        </div>
                                    </div>
                                </section>

                                {/* è¡Œææ¸…å–® (å–®æ©Ÿç‰ˆ) */}
                                <section>
                                    <div className="flex items-center gap-4 mb-8 px-4">
                                        <div className="p-4 bg-pink-100 rounded-3xl text-[#FF91C1]"><Icon name="luggage" size={40} /></div>
                                        <h3 className="text-4xl font-black text-slate-800">è¡Œææ¸…å–® (å–®æ©Ÿ) ğŸ’œ</h3>
                                    </div>

                                    {packingListTemplate.map((cat, idx) => (
                                        <div key={idx} className="mb-10">
                                            <p className="text-md font-black text-[#9D76C1] mb-6 px-6 border-l-[10px] border-[#9D76C1] ml-4 uppercase tracking-[0.2em]">{cat.category}</p>
                                            <div className="space-y-4 px-4">
                                                {cat.items.map((item, i) => (
                                                    <div 
                                                        key={i} 
                                                        onClick={() => togglePacking(item)}
                                                        className={`kuromi-card p-6 flex items-center gap-6 transition-all active:scale-95 cursor-pointer ${packingItems[item] ? 'packing-item-done' : ''}`}
                                                    >
                                                        <div className={`w-10 h-10 rounded-2xl border-4 flex items-center justify-center transition-all ${packingItems[item] ? 'bg-[#9D76C1] border-transparent' : 'border-[#E2D9F3]'}`}>
                                                            {packingItems[item] && <Icon name="check" className="text-white" size={24} />}
                                                        </div>
                                                        <span className={`text-2xl font-black text-slate-700 ${packingItems[item] ? 'packing-text-done' : ''}`}>{item}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </section>

                                <div className="p-12 opacity-30 font-black text-center">
                                    <p className="flex items-center justify-center gap-2">
                                        <Icon name="check-circle" size={16} className="text-green-600" />
                                        è¨˜å¸³é›²ç«¯åŒæ­¥å·²å°±ç·’ ğŸ’œ
                                    </p>
                                    <p className="text-xs mt-3 uppercase tracking-widest italic">è¡Œææ¸…å–®ç‚ºå–®æ©Ÿæ“ä½œï¼Œé‡æ•´å°‡æœƒé‡ç½®</p>
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 h-10 kuromi-gradient z-[60]" />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
