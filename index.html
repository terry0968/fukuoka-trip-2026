<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Á¶èÂ≤° 2026 | Kuromi ÂÆ∂ÊóèÂ§ßÂÜíÈö™</title>

    <!-- Ê†∏ÂøÉÂ∫´ÂºïÂÖ• -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK (Áõ∏ÂÆπÁâà) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');
        
        :root {
            --kuromi-purple: #9D76C1;
            --kuromi-dark: #2D2727;
            --kuromi-pink: #FF91C1;
            --kuromi-bg: #F9F7FC;
        }

        body { 
            font-family: 'ZCOOL KuaiLe', cursive; 
            background-color: var(--kuromi-bg); 
            color: var(--kuromi-dark);
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            font-size: 16px;
        }

        .kuromi-gradient { background: linear-gradient(135deg, #9D76C1 0%, #765898 100%); }
        .bg-pattern { 
            background-image: radial-gradient(var(--kuromi-purple) 0.5px, transparent 0.5px); 
            background-size: 20px 20px; 
        }

        .kuromi-card { 
            background: white; 
            border-radius: 30px; 
            border: 3px solid #E2D9F3; 
            box-shadow: 0 4px 12px rgba(157, 118, 193, 0.08);
            transition: all 0.2s ease;
        }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-custom { animation: spin-slow 1s linear infinite; }
        
        button { user-select: none; cursor: pointer; }

        .packing-item-done { 
            background-color: #F3F0F8 !important; 
            border-color: #D1C4E9 !important;
            opacity: 0.7;
            transform: scale(0.98);
        }
        .packing-text-done { 
            text-decoration: line-through; 
            color: #BDB7C4 !important;
        }

        .modal-mask {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .tab-active { color: #9D76C1; border-bottom: 4px solid #9D76C1; }
    </style>
</head>
<body class="bg-pattern">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Firebase ÈÖçÁΩÆ
        const firebaseConfig = {
            apiKey: "AIzaSyCAb0qAoOh0A88-wuRz-Gk_cU5f2vIOd3c",
            authDomain: "fukuoka-2026.firebaseapp.com",
            projectId: "fukuoka-2026",
            storageBucket: "fukuoka-2026.firebasestorage.app",
            messagingSenderId: "545717934606",
            appId: "1:545717934606:web:0d6ba3dd86addc76a77a5f"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "fukuoka-2026";

        // SVG ÂúñÊ®ôÁµÑ‰ª∂
        const Icon = ({ name, className = "", size = 24 }) => {
            const icons = {
                'heart': "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.505 4.04 3 5.5L12 21l7-7Z",
                'coins': "M11 15h2M12 12V3c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v1h1a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h1V3c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v9Z",
                'check-circle': "M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4L12 14.01l-3-3",
                'trash': "M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",
                'refresh': "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8 M21 3v5h-5 M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16 M3 21v-5h5",
                'hotel': "M3 21V9a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12M7 11h2M7 15h2M15 11h2M15 15h2M11 21v-4a1 1 0 0 1 1-1h0a1 1 0 0 1 1 1v4",
                'luggage': "M3 14h18M7 21h10M3 7h18a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2zM7 7V4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v3",
                'check': "M20 6L9 17l-5-5",
                'plus': "M12 5v14M5 12h14",
                'pencil': "M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z",
                'chevron-left': "M15 18l-6-6 6-6",
                'chevron-down': "M6 9l6 6 6-6",
                'chevron-right': "M9 18l6-6-6-6",
                'navigation': "M3 11l19-9-9 19-2-8-8-2z",
                'alert': "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01"
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={`${className} pointer-events-none transition-all`}>
                    <path d={icons[name] || ""} />
                </svg>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [expenses, setExpenses] = useState([]);
            const [itineraryData, setItineraryData] = useState([]);
            const [packingItems, setPackingItems] = useState({});
            const [activeTab, setActiveTab] = useState('itinerary'); 
            const [itineraryView, setItineraryView] = useState('list');
            const [selectedDayIdx, setSelectedDayIdx] = useState(0);
            const [fxInput, setFxInput] = useState('');
            const exchangeRate = 0.211;

            const [expandedCats, setExpandedCats] = useState({
                '‰∏Ä„ÄÅË≠â‰ª∂ËàáÈáëÈå¢': true,
                '‰∫å„ÄÅRuby ÂØ∂ÂØ∂Â∞àÂçÄ': true,
                '‰∏â„ÄÅË°£Áâ©ÈÖç‰ª∂': true,
                'Âõõ„ÄÅ3C Êï∏‰ΩçÁî¢ÂìÅ': true,
                '‰∫î„ÄÅËó•ÂìÅËàá‰øùÂÅ•': true,
                'ÂÖ≠„ÄÅÁõ•Ê¥óËàáÊ∏ÖÊΩî': true
            });

            const [newExpense, setNewExpense] = useState({ 
                date: new Date().toISOString().split('T')[0], 
                payer: 'KCY', item: '', amount: '' 
            });

            const [isEditingPlan, setIsEditingPlan] = useState(false);
            const [editingPlan, setEditingPlan] = useState(null);
            const [editPlanBuffer, setEditPlanBuffer] = useState({ time: '', title: '' });

            const [isSaving, setIsSaving] = useState(false);
            const [toast, setToast] = useState({ show: false, msg: '' });

            const members = ['KCY', 'Ruby', 'YSL', 'Tsai'];
            const dates = [
                { date: '5/30', dayName: 'SAT' }, { date: '5/31', dayName: 'SUN' },
                { date: '6/1', dayName: 'MON' }, { date: '6/2', dayName: 'TUE' },
                { date: '6/3', dayName: 'WED' }, { date: '6/4', dayName: 'THU' },
                { date: '6/5', dayName: 'FRI' }, { date: '6/6', dayName: 'SAT' }
            ];

            const packingListTemplate = [
                { category: '‰∏Ä„ÄÅË≠â‰ª∂ËàáÈáëÈå¢', items: ['Ë≠∑ÁÖß (Ê≠£Êú¨+ÂΩ±Êú¨)', 'Visit Japan Web QR Code', 'Êó•Âπ£ÁèæÈáë', '‰ø°Áî®Âç°/ÊÇ†ÈÅäÂç°', 'ÊóÖÈÅä‰øùÈö™Ë≠âÊòéÊõ∏'] },
                { category: '‰∫å„ÄÅRuby ÂØ∂ÂØ∂Â∞àÂçÄ', items: ['Ë∂≥ÈáèÂ∞øÂ∏É & ÊøïÁ¥ôÂ∑æ', 'Â•∂Á≤âÂàÜË£ùÂåÖ & Â•∂Áì∂', 'ÂâØÈ£üÂìÅ & ÂØ∂ÂØ∂Èõ∂È£ü', 'ÂØ∂ÂØ∂È§êÂÖ∑ & ÂúçÂÖú', 'ÊâãÊé®Ëªä & Èò≤Èõ®ÁΩ©', 'Â∞èÊØØÂ≠ê & ÊèõÊ¥óË°£Áâ©'] },
                { category: '‰∏â„ÄÅË°£Áâ©ÈÖç‰ª∂', items: ['ÊèõÊ¥óË°£Áâ© (3-4Â•ó)', 'ÂÖßË°£Ë§≤ & Ë•™Â≠ê', 'ËàíÈÅ©Â•ΩËµ∞ÁöÑÈûã', 'Ëºï‰æøÂ§ñÂ•ó (ËñÑ)', 'Êë∫ÁñäÈõ®ÂÇò & Ëºï‰æøÈõ®Ë°£', 'Â∏ΩÂ≠ê & Â§™ÈôΩÁúºÈè°'] },
                { category: 'Âõõ„ÄÅ3C Êï∏‰ΩçÁî¢ÂìÅ', items: ['ÊâãÊ©ü & Ë°åÂãïÈõªÊ∫ê', 'ÂÖÖÈõªÁ∑ö & ÂÖÖÈõªÈ†≠', 'WiFiÊ©ü/Á∂≤Âç°', 'ÈôçÂô™ËÄ≥Ê©ü', 'Áõ∏Ê©ü & Ë®òÊÜ∂Âç°'] },
                { category: '‰∫î„ÄÅËó•ÂìÅËàá‰øùÂÅ•', items: ['ÂÄã‰∫∫ËôïÊñπËó•', 'Â∏∏ÂÇôÊÑüÂÜí/ËÖ∏ËÉÉËó•', 'ÈÄÄÁáíËó•/Ê≠¢ÁóõËó•', 'Èò≤ËöäÊ∂≤ & Ê≠¢Áô¢Ëó•ËÜè', 'OKÁπÉ & ÈÖíÁ≤æÊ£âÁâá'] },
                { category: 'ÂÖ≠„ÄÅÁõ•Ê¥óËàáÊ∏ÖÊΩî', items: ['ÁâôÂà∑ & ÁâôËÜè', 'Ê¥óÈù¢‰π≥ & Ë≠∑ËÜöÂìÅ', '‰πæÊ¥óÊâã & Âè£ÁΩ©', 'Ë°õÁîüÁ¥ô & ÁîüÁêÜÁî®ÂìÅ'] }
            ];

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(u => {
                    if (u) setUser(u);
                    else auth.signInAnonymously().catch(err => console.error("Login fail", err));
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const pathBase = `artifacts/${appId}/public/data`;
                
                const unsubExp = db.collection(`${pathBase}/expenses`).onSnapshot(snap => {
                    const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    setExpenses(docs.sort((a, b) => (b.date || "").localeCompare(a.date || "")));
                }, err => console.error(err));

                const unsubItinerary = db.collection(`${pathBase}/itinerary`).onSnapshot(snap => {
                    const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    setItineraryData(docs);
                }, err => console.error(err));

                return () => { unsubExp(); unsubItinerary(); };
            }, [user]);

            const currentDayPlans = useMemo(() => {
                const day = dates[selectedDayIdx];
                if (!day) return [];
                const target = day.date;
                const timeToMinutes = (t) => {
                    if (!t) return 9999;
                    const digits = t.match(/\d+/g);
                    if (!digits || digits.length === 0) return 9999;
                    const h = parseInt(digits[0], 10);
                    const m = digits.length > 1 ? parseInt(digits[1], 10) : 0;
                    return h * 60 + m;
                };

                return (itineraryData || [])
                    .filter(p => p && p.targetDate === target)
                    .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));
            }, [itineraryData, selectedDayIdx]);

            const showToast = (msg) => {
                setToast({ show: true, msg });
                setTimeout(() => setToast({ show: false, msg: '' }), 3000);
            };

            const addExpense = async () => {
                if (!newExpense.item.trim() || isNaN(parseFloat(newExpense.amount)) || !user) return;
                setIsSaving(true);
                try {
                    const id = `exp-${Date.now()}`;
                    await db.collection(`artifacts/${appId}/public/data/expenses`).doc(id).set({
                        ...newExpense,
                        amount: parseFloat(newExpense.amount),
                        amountTwd: Math.round(parseFloat(newExpense.amount) * exchangeRate),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setNewExpense(prev => ({ ...prev, item: '', amount: '' }));
                    showToast("Â∑≤Â≠òÂÖ•Èõ≤Á´Ø üíú");
                } catch(e) { console.error(e); } 
                finally { setIsSaving(false); }
            };

            const openEditModal = (e, plan) => {
                e.preventDefault();
                e.stopPropagation(); 
                setEditingPlan(plan);
                setEditPlanBuffer({ time: plan.time || '', title: plan.title || '' });
                setIsEditingPlan(true);
            };

            const savePlan = async () => {
                if (!editPlanBuffer.time || !editPlanBuffer.title || !user) return;
                setIsSaving(true);
                try {
                    const id = editingPlan ? editingPlan.id : `plan-${Date.now()}`;
                    await db.collection(`artifacts/${appId}/public/data/itinerary`).doc(id).set({
                        ...editPlanBuffer,
                        targetDate: dates[selectedDayIdx].date,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                    setIsEditingPlan(false);
                    setEditingPlan(null);
                    showToast("Ë°åÁ®ãÂêåÊ≠•ÊàêÂäü üíú");
                } catch(e) { console.error(e); }
                finally { setIsSaving(false); }
            };

            const deletePlan = async (e, id) => {
                e.preventDefault();
                e.stopPropagation();
                if (!window.confirm("Á¢∫ÂÆöÂà™Èô§Ôºü")) return;
                await db.collection(`artifacts/${appId}/public/data/itinerary`).doc(id).delete();
                showToast("Ë°åÁ®ãÂ∑≤ÁßªÈô§");
            };

            const togglePacking = (itemName) => {
                setPackingItems(prev => ({ ...prev, [itemName]: !prev[itemName] }));
            };

            const toggleCategory = (catName) => {
                setExpandedCats(prev => ({ ...prev, [catName]: !prev[catName] }));
            };

            return (
                <div className="max-w-md mx-auto min-h-screen relative pb-20">
                    <div className={`fixed top-6 left-1/2 -translate-x-1/2 z-[200] transition-all duration-500 ${toast.show ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-10 pointer-events-none'}`}>
                        <div className="bg-black/90 text-white px-6 py-3 rounded-full flex items-center gap-2 shadow-xl border border-purple-400 backdrop-blur-md text-sm text-center">
                            <Icon name="check-circle" size={18} className="text-pink-400" />
                            <span className="font-bold">{toast.msg}</span>
                        </div>
                    </div>

                    <header className="kuromi-gradient text-white p-6 pt-10 rounded-b-[40px] shadow-lg text-center relative overflow-hidden">
                        <h1 className="text-5xl font-bold tracking-tighter" style={{ textShadow: '2px 2px 0px rgba(0,0,0,0.2)' }}>Á¶èÂ≤° 2026</h1>
                        <div className="flex items-center justify-center gap-2 mt-2">
                            <span className="bg-black/30 px-3 py-1 rounded-full text-[10px] uppercase tracking-widest">SHEN FAMILY TRIP</span>
                            <Icon name="heart" size={14} className="fill-pink-400 text-pink-400 animate-pulse" />
                        </div>
                    </header>

                    <nav className="flex bg-white/95 backdrop-blur-lg sticky top-0 z-50 px-4 border-b-4 border-purple-50 shadow-sm">
                        <button onClick={() => { setActiveTab('itinerary'); setItineraryView('list'); }} className={`flex-1 py-4 font-black text-lg transition-all ${activeTab === 'itinerary' ? 'tab-active' : 'text-slate-400'}`}>Ë°åÁ®ã</button>
                        <button onClick={() => setActiveTab('expense')} className={`flex-1 py-4 font-black text-lg transition-all ${activeTab === 'expense' ? 'tab-active' : 'text-slate-400'}`}>Ë®òÂ∏≥</button>
                        <button onClick={() => setActiveTab('tools')} className={`flex-1 py-4 font-black text-lg transition-all ${activeTab === 'tools' ? 'tab-active' : 'text-slate-400'}`}>Â∑•ÂÖ∑</button>
                    </nav>

                    <div className="px-5 py-6">
                        {activeTab === 'itinerary' && (
                            itineraryView === 'list' ? (
                                <div className="space-y-6 animate-in fade-in">
                                    <h2 className="text-2xl font-black text-slate-800 px-1 flex justify-between items-center">ÂÜíÈö™Ë®àÁï´Ë°® üíú</h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        {dates.map((day, idx) => (
                                            <div key={day.date} onClick={() => { setSelectedDayIdx(idx); setItineraryView('detail'); }} 
                                                 className="kuromi-card p-6 flex flex-col items-center justify-center text-center relative active:scale-95 border-b-[8px] border-b-[#9D76C1]">
                                                <span className="text-[10px] font-black text-purple-300 uppercase mb-1">{day.dayName}</span>
                                                <span className="text-5xl font-black text-slate-700 mb-2">{day.date.split('/')[1]}</span>
                                                <span className="text-[10px] font-black text-white bg-purple-400 px-3 py-1 rounded-full">{day.date}</span>
                                                {itineraryData && itineraryData.some(p => p && p.targetDate === day.date) && <div className="absolute top-4 right-4 w-3 h-3 bg-pink-400 rounded-full animate-pulse border-2 border-white shadow-sm" />}
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={() => window.open('https://maps.app.goo.gl/pd5Mgn8orC6EG7dc6', '_blank')} 
                                            className="w-full bg-[#2D2727] text-white py-5 rounded-[30px] flex items-center justify-center gap-3 shadow-lg active:scale-95 border-2 border-purple-900/10">
                                        <Icon name="navigation" size={20} className="text-pink-400" />
                                        <span className="font-black text-xl tracking-wider">Âú∞ÂúñË°åÁ®ã</span>
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-6 animate-in slide-in-from-bottom">
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => setItineraryView('list')} className="p-3 bg-white rounded-full shadow text-purple-600 active:scale-75 border border-purple-50">
                                            <Icon name="chevron-left" size={20} />
                                        </button>
                                        <div>
                                            <h2 className="text-3xl font-black text-slate-800">{dates[selectedDayIdx]?.date}</h2>
                                            <p className="text-[10px] font-black text-purple-400 uppercase tracking-widest">Êú¨Êó•Ë®àÁï´</p>
                                        </div>
                                    </div>
                                    <button onClick={() => { setEditingPlan(null); setEditPlanBuffer({time:'', title:''}); setIsEditingPlan(true); }} 
                                            className="w-full bg-white border-2 border-dashed border-purple-200 text-purple-500 py-6 rounded-[30px] flex items-center justify-center gap-2 active:scale-95 shadow-inner">
                                        <Icon name="plus" size={20} />
                                        <span className="font-black text-2xl">Êñ∞Â¢ûË®àÁï´</span>
                                    </button>
                                    <div className="space-y-4">
                                        {(currentDayPlans || []).map(plan => (
                                            <div key={plan.id} className="kuromi-card p-5 flex flex-col border-l-[15px] border-l-[#9D76C1] shadow-md">
                                                <div className="flex justify-between items-center mb-4">
                                                    <span className="text-xs font-black text-white bg-slate-800 px-3 py-1 rounded-full">{plan.time}</span>
                                                    <div className="flex gap-1">
                                                        <button type="button" onClick={(e) => openEditModal(e, plan)} className="w-12 h-12 flex items-center justify-center bg-purple-50 text-purple-400 rounded-full active:scale-75 border border-purple-100"><Icon name="pencil" size={20} /></button>
                                                        <button type="button" onClick={(e) => deletePlan(e, plan.id)} className="w-12 h-12 flex items-center justify-center bg-red-50 text-red-400 rounded-full active:scale-75 border border-red-100"><Icon name="trash" size={20} /></button>
                                                    </div>
                                                </div>
                                                <h3 className="text-2xl font-black text-slate-700 leading-tight">{plan.title}</h3>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )
                        )}

                        {activeTab === 'expense' && (
                            <div className="space-y-6 animate-in fade-in">
                                <div className="bg-[#2D2727] text-white p-8 rounded-[40px] shadow-xl relative overflow-hidden">
                                    <p className="text-[10px] text-[#FF91C1] font-black uppercase tracking-[0.2em] mb-4">JPY ‚Æï TWD Âç≥ÊôÇÊèõÁÆó</p>
                                    <div className="flex items-center justify-between">
                                        <input type="number" value={fxInput} onChange={(e) => setFxInput(e.target.value)} placeholder="0" className="flex-1 bg-transparent text-5xl font-black focus:outline-none placeholder:text-white/10 w-full" />
                                        <div className="text-right flex-shrink-0">
                                            <p className="text-[10px] opacity-40 font-black mb-0.5">NT$</p>
                                            <p className="text-5xl font-black text-[#FF91C1]">{Math.round((parseFloat(fxInput) || 0) * exchangeRate).toLocaleString()}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-[40px] p-8 space-y-6 shadow-xl border-4 border-purple-50">
                                    <h3 className="text-xl font-black underline decoration-pink-300 decoration-4">Êñ∞Â¢ûËä±Ë≤ª üíú</h3>
                                    <div className="space-y-4">
                                        <div className="flex gap-4">
                                            <input type="date" value={newExpense.date} onChange={(e) => setNewExpense({...newExpense, date: e.target.value})} className="flex-1 border-b-2 border-purple-50 pb-2 text-sm font-black focus:border-purple-400 outline-none bg-transparent" />
                                            <select value={newExpense.payer} onChange={(e) => setNewExpense({...newExpense, payer: e.target.value})} className="bg-purple-50 rounded-full px-4 py-2 font-black text-xs text-[#9D76C1] outline-none">
                                                {members.map(m => <option key={m} value={m}>{m}</option>)}
                                            </select>
                                        </div>
                                        <input placeholder="Ë≤∑‰∫Ü‰ªÄÈ∫ºÔºü" value={newExpense.item} onChange={(e) => setNewExpense({...newExpense, item: e.target.value})} className="w-full border-b-2 border-purple-50 pb-2 text-sm font-black focus:border-purple-400 outline-none" />
                                        <input type="number" placeholder="ÈáëÈ°ç ¬•" value={newExpense.amount} onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})} className="w-full border-2 border-purple-50 p-4 text-xl font-black focus:border-purple-400 outline-none bg-slate-50 rounded-2xl" />
                                    </div>
                                    <button onClick={addExpense} disabled={isSaving} className="w-full kuromi-gradient text-white py-4 rounded-full font-black text-2xl shadow-lg active:scale-95 flex items-center justify-center gap-2">
                                        {isSaving ? <Icon name="refresh" className="animate-spin-custom" size={18} /> : "Á¥ÄÈåÑÈñãÈä∑ üíú"}
                                    </button>
                                </div>
                                {(expenses || []).map((ex, idx) => (
                                    <div key={ex.id || idx} className="kuromi-card p-5 flex justify-between items-center border-l-[12px] border-l-[#9D76C1] shadow-sm">
                                        <div className="flex-1 mr-2">
                                            <div className="flex items-center gap-2 mb-1">
                                                <span className="text-[9px] font-black text-white bg-slate-800 px-2 py-0.5 rounded-full">{ex.date}</span>
                                                <span className="text-[9px] text-slate-400 font-black uppercase">{ex.payer}</span>
                                            </div>
                                            <p className="text-2xl font-black text-slate-700">{ex.item}</p>
                                        </div>
                                        <div className="text-right flex items-center gap-3">
                                            <div>
                                                <p className="text-3xl font-black text-slate-800">¬•{ex.amount?.toLocaleString()}</p>
                                                <p className="text-[10px] font-black text-pink-400">NT${ex.amountTwd?.toLocaleString()}</p>
                                            </div>
                                            <button onClick={() => { if(window.confirm("Âà™Èô§ÈÄôÁ≠ÜÈñãÈä∑Ôºü")) db.collection(`artifacts/${appId}/public/data/expenses`).doc(ex.id).delete(); }} className="p-2 bg-red-50 text-red-400 rounded-full border border-red-50"><Icon name="trash" size={14}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'tools' && (
                            <div className="space-y-10 animate-in fade-in">
                                <section className="text-center">
                                    <div className="bg-white rounded-[40px] border-4 border-[#9D76C1] p-8 shadow-xl relative">
                                        <Icon name="hotel" size={40} className="text-purple-200 mx-auto mb-2 animate-bounce" />
                                        <h3 className="text-3xl font-black mb-1 text-[#2D2727]">ÂçöÂ§öË•øÈêµ CROOM</h3>
                                        <p className="text-[10px] text-slate-400 mb-6 font-black tracking-widest">ÂçöÂ§öÁ•áÂúíÊ´õÁî∞Á•ûÁ§æÂâçÁ´ô</p>
                                        <div className="flex gap-4">
                                            <button onClick={() => window.open('https://www.google.com/maps/search/?api=1&query=ÂçöÂ§öÁ•áÂúíÊ´õÁî∞Á•ûÁ§æÂâçË•øÈêµÂÖãÈ≠ØÂßÜÈÖíÂ∫ó','_blank')} className="flex-1 kuromi-gradient text-white py-4 rounded-2xl font-black text-sm shadow-md">Âú∞ÂúñÂÆö‰Ωç</button>
                                            <a href="tel:092-235-0311" className="flex-1 border-2 border-[#2D2727] text-center py-4 rounded-2xl font-black text-sm">Êí•ÊâìÈõªË©±</a>
                                        </div>
                                    </div>
                                </section>

                                <section>
                                    <div className="flex items-center gap-3 mb-6 px-1">
                                        <div className="p-3 bg-pink-100 rounded-2xl text-[#FF91C1]"><Icon name="luggage" size={24} /></div>
                                        <h3 className="text-2xl font-black text-slate-800">Ë°åÊùéÊ∏ÖÂñÆ üíú</h3>
                                    </div>
                                    {packingListTemplate.map((cat, idx) => {
                                        const isExpanded = expandedCats[cat.category];
                                        return (
                                            <div key={idx} className="mb-6">
                                                <div 
                                                    onClick={() => toggleCategory(cat.category)}
                                                    className="flex items-center justify-between bg-white/50 p-4 rounded-3xl active:bg-purple-100 transition-all cursor-pointer"
                                                >
                                                    <p className="text-xl font-black text-[#8A63B3] border-l-8 border-[#9D76C1] px-4 uppercase tracking-wide">
                                                        {cat.category}
                                                    </p>
                                                    <Icon name={isExpanded ? "chevron-down" : "chevron-right"} size={24} className="text-purple-300" />
                                                </div>
                                                
                                                {isExpanded && (
                                                    <div className="space-y-3 px-2 mt-4 animate-in fade-in slide-in-from-top-2 duration-300">
                                                        {cat.items.map(item => {
                                                            const isDone = packingItems[item] === true;
                                                            return (
                                                                <div key={item} onClick={() => togglePacking(item)} className={`kuromi-card p-4 flex items-center gap-4 active:scale-95 ${isDone ? 'packing-item-done' : ''}`}>
                                                                    <div className={`w-8 h-8 rounded-xl border-2 flex items-center justify-center transition-all ${isDone ? 'bg-[#9D76C1] border-transparent' : 'border-[#E2D9F3]'}`}>
                                                                        {isDone && <Icon name="check" className="text-white" size={16} />}
                                                                    </div>
                                                                    <span className={`text-lg font-black text-slate-700 ${isDone ? 'packing-text-done' : ''}`}>{item}</span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </section>
                            </div>
                        )}
                    </div>

                    {isEditingPlan && (
                        <div className="fixed inset-0 z-[110] modal-mask flex items-center justify-center p-6">
                            <div className="bg-white w-full rounded-[40px] p-10 shadow-2xl space-y-8 border-8 border-purple-50 animate-in zoom-in">
                                <h3 className="text-3xl font-black text-slate-800 underline decoration-pink-300 decoration-4 underline-offset-4 text-center">{editingPlan ? '‰øÆÊîπË®àÁï´ ‚úèÔ∏è' : 'Êñ∞Â¢ûË®àÁï´ ‚úèÔ∏è'}</h3>
                                <div className="space-y-6 text-left">
                                    <div>
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">È†êË®àÊôÇÈñì</label>
                                        <input value={editPlanBuffer.time} onChange={(e) => setEditPlanBuffer({...editPlanBuffer, time: e.target.value})} placeholder="14:30" className="w-full border-2 border-purple-50 p-4 text-2xl font-black focus:border-purple-400 outline-none bg-slate-50 rounded-2xl mt-1" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Ë®àÁï´ÂÖßÂÆπ</label>
                                        <input value={editPlanBuffer.title} onChange={(e) => setEditPlanBuffer({...editPlanBuffer, title: e.target.value})} placeholder="Ë¶ÅÂéªÂì™Ë£°Âë¢Ôºü" className="w-full border-2 border-purple-50 p-4 text-2xl font-black focus:border-purple-400 outline-none bg-slate-50 rounded-2xl mt-1" />
                                    </div>
                                </div>
                                <div className="flex gap-4 pt-2">
                                    <button onClick={savePlan} disabled={isSaving} className="flex-1 kuromi-gradient text-white py-5 rounded-full font-black text-2xl shadow-lg active:scale-95 disabled:opacity-50">{isSaving ? <Icon name="refresh" className="animate-spin-custom mx-auto" size={24} /> : "ÂÑ≤Â≠ò üíú"}</button>
                                    <button onClick={() => { setIsEditingPlan(false); setEditingPlan(null); }} className="px-8 bg-slate-100 text-slate-400 rounded-full font-black text-sm text-center">ÂèñÊ∂à</button>
                                </div>
                            </div>
                        </div>
                    )}
                    <div className="fixed bottom-0 left-0 right-0 h-4 kuromi-gradient z-[60]" />
                </div>
            );
        };

        // üõ°Ô∏è ‰øÆÂæ©ÊéõËºâÈÇèËºØÔºåÁ¢∫‰øù Root Â≠òÂú®‰∏î‰∏çÊúÉÁôºÁîüÁ©∫ËΩâ
        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = ReactDOM.createRoot(rootElement);
            root.render(<App />);
        }
    </script>
</body>
</html>
